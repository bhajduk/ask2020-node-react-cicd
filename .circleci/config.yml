 version: 2.1
 orbs:
   node: circleci/node@3.0.0
   docker: circleci/docker@1.2.1
 jobs:
   build-and-test:
    executor: node/default
    steps:
     - checkout
     - run: cd client && npm install
     - run: cd client && npm test
     - run: cd server && npm install
     - run: cd server && npm test
   deploy:
    executor: docker/docker
    steps:
     - checkout
     - run: cd client && docker build -t lab2_client .
     - run: cd client && docker push lab2_client
     - run: cd server && docker build -t lab2_server .
     - run: cd server && docker push lab2_server
 workflows:
   build-test-and-deploy:
    jobs:
     - build-and-test:
       filters:
         branches:
           only:
             - master
     - deploy:
       requires:
         - build-and-test:
           filters:
             branches:
               only:
                 - master
